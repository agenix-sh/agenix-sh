# AGEniX Schema Specifications

This directory contains JSON Schema definitions for AGEniX data structures.

## Schema Files

### ✅ Canonical Schemas (Use These)

#### `job.schema.json` - Job Envelope (Execution Layer 3)
**Status:** ✅ **CANONICAL**
**Use for:** Jobs submitted to AGQ and executed by AGW

A **Job** is a runtime execution instance. It includes:
- `job_id` - Unique identifier for this execution (generated by AGQ)
- `plan_id` - Reference to the Plan template being executed
- `tasks[]` - Tasks to execute (with `task_number`, `command`, `args`)

**Documentation:** See `docs/architecture/job-schema.md` for full specification.

**Used by:**
- AGQ: Validates jobs, stores in database
- AGW: Parses jobs, executes tasks
- AGX: Queries job status

---

#### `registry.schema.json` - AU Registry Entry
**Status:** ✅ **CANONICAL**
**Use for:** Agentic Unit registry entries

Defines how AUs advertise their capabilities.

**Documentation:** See `docs/au-specs/agentic-unit-spec.md`

---

#### `describe.schema.json` - AU Model Card
**Status:** ✅ **CANONICAL**
**Use for:** AU self-description (output of `--describe`)

Defines the model card structure returned by `au-tool --describe`.

**Documentation:** See `docs/au-specs/agentic-unit-spec.md`

---

### ⚠️ Deprecated Schemas (Do Not Use)

#### `plan.schema.json` - Old Plan Schema
**Status:** ⚠️ **DEPRECATED**
**Reason:** Used outdated nomenclature (`steps`, `tool`, `id`)

**Migration:** Use `job.schema.json` instead.

This schema used:
- `steps` → Now `tasks`
- `tool` → Now `command`
- `id` → Now `task_number`

**Kept for:** Historical reference only. Do not use in new code.

---

## Execution Layers and Schemas

AGEniX has 5 execution layers (see `docs/architecture/execution-layers.md`):

1. **Task** - Atomic unit (no dedicated schema)
2. **Plan** - Reusable template (no dedicated schema yet - see note below)
3. **Job** - Runtime instance → `job.schema.json` ✅
4. **Action** - Multiple jobs (Phase 2)
5. **Workflow** - Multi-action orchestration (Phase 2+)

### Plan vs Job Schema Distinction

**Important:** There is currently confusion about Plan schema (Layer 2) vs Job schema (Layer 3).

**Current State:**
- `job.schema.json` defines the **Job envelope** (Layer 3)
- No separate **Plan schema** file exists yet for Layer 2
- AGQ currently accepts Plans via `PLAN.SUBMIT` but validation is inconsistent

**Recommended Approach (per AGQ CLAUDE.md):**

**Plan Schema (Layer 2) - For `PLAN.SUBMIT`:**
```json
{
  "plan_id": "uuid",
  "plan_description": "...",
  "tasks": [
    {
      "task_number": 1,
      "command": "echo",
      "args": ["hello"],
      "timeout_secs": 30,
      "input_from_task": null
    }
  ]
}
```
**Note:** Does NOT include `job_id` (generated later by AGQ)

**Job Schema (Layer 3) - For `JOB.STATUS`, `ACTION.SUBMIT`:**
```json
{
  "job_id": "uuid-generated-by-agq",
  "plan_id": "uuid",
  "plan_description": "...",
  "tasks": [/* same as Plan */]
}
```
**Note:** Includes `job_id` (generated by AGQ when creating Job from Plan)

### Action Items

- [ ] Create separate `plan.schema.json` for Layer 2 (Plan template)
- [ ] Keep `job.schema.json` for Layer 3 (Job envelope)
- [ ] Update AGQ-019 to clarify Plan vs Job distinction
- [ ] Add schema version field to both Plan and Job

---

## Schema Validation

### AGQ (Queue)
- Uses embedded PLAN_SCHEMA constant (needs update to match job.schema.json)
- Location: `agq/src/server.rs`
- See: Issue AGQ-019 for schema alignment work

### AGX (Planner)
- Generates job envelopes for submission
- Should validate against job.schema.json before submission

### AGW (Worker)
- Parses jobs from AGQ
- Should validate against job.schema.json on receipt

---

## Canonical Documentation

For complete specifications, see:

- **Execution Layers:** `docs/architecture/execution-layers.md`
- **Job Schema:** `docs/architecture/job-schema.md`
- **System Overview:** `docs/architecture/system-overview.md`
- **AU Specification:** `docs/au-specs/agentic-unit-spec.md`

---

## Schema Versioning

**Current:** Schemas do not include version fields (except optional `version` string in old plan.schema.json)

**Recommendation:** Add `schema_version` field to all schemas for future compatibility:
```json
{
  "schema_version": "1.0",
  "job_id": "...",
  ...
}
```

---

## Questions?

- **Schema issues:** Open issue in agenix-sh/agenix repository
- **Implementation issues:** Open issue in component repository (agx, agq, agw)
- **Clarifications:** See canonical documentation in `docs/architecture/`

---

**Last Updated:** 2025-11-18
**Related Issues:** AGQ-019 (schema alignment), agenix#11 (schema mismatch tracking)
